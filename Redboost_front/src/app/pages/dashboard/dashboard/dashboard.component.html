<div class="dashboard-wrapper">
    <div class="dashboard-container">
      <!-- Message d'erreur -->
      <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
  
      <!-- Contenu principal -->
      <div *ngIf="statistics; else loading">
        <!-- Aperçu des Projets -->
        <div class="card overview-card">
          <h2>Aperçu des Projets</h2>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="label">Total des Projets</span>
              <span class="value">{{ statistics!.projects.totalProjects }}</span>
            </div>
            <div class="stat-item">
              <span class="label">Progrès Moyen</span>
              <span class="value">{{ statistics!.projects.averageProgress | number:'1.0-2' }}%</span>
            </div>
            <div class="stat-item">
              <span class="label">Prêt pour Révision</span>
              <span class="value">{{ statistics!.projects.reviewReadyProjects }}</span>
            </div>
            <div class="stat-item">
              <span class="label">Projets Actifs</span>
              <span class="value">{{ statistics!.projects.activeProjects }}</span>
            </div>
          </div>
        </div>
  
        <!-- Charts Container (Répartition des Projets + Achèvement des Phases) -->
        <div class="card charts-container">
          <!-- Répartition des Projets -->
          <div class="chart-card pie-chart-card">
            <h2>Répartition des Projets</h2>
            <div class="pie-chart-wrapper">
              <canvas baseChart
                [data]="pieChartData"
                [options]="pieChartOptions"
                [type]="pieChartType">
              </canvas>
            </div>
          </div>
  
          <!-- Achèvement des Phases -->
          <div class="chart-card bar-chart-card">
            <h2>Achèvement des Phases</h2>
            <canvas baseChart
              [data]="barChartData"
              [options]="barChartOptions"
              [type]="barChartType">
            </canvas>
          </div>
        </div>
  
        <!-- Aperçu des Tâches -->
        <div class="card">
          <h2>Aperçu des Tâches</h2>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="label">Validations en Attente</span>
              <span class="value">{{ statistics!.tasks.pendingValidations }}</span>
            </div>
            <div class="stat-item">
              <span class="label">Tâches en Retard</span>
              <span class="value">{{ statistics!.tasks.overdueTasks }}</span>
            </div>
          </div>
        </div>
  
        <!-- Actions en Attente (Updated to emphasize project names) -->
        <div class="card">
          <h2>Actions en Attente</h2>
          <div class="scrollable">
            <ul>
              <li *ngFor="let action of statistics!.pendingActions">
                <div class="action-item">
                  <span class="action-type" [ngClass]="{'phase': action.type === 'phase', 'task': action.type !== 'phase'}">
                    {{ action.type === 'phase' ? 'Phase' : 'Tâche' }}
                  </span>
                  <span class="action-details">
                    <span class="project-name">{{ action.projectName }}</span>
                    <span class="sub-details">
                      - {{ action.phaseName }}
                      {{ action.taskTitle ? '- ' + action.taskTitle : '' }}
                      <span class="details">({{ action.details }})</span>
                    </span>
                  </span>
                </div>
              </li>
            </ul>
          </div>
        </div>
  
        <!-- Engagement -->
        <div class="card">
          <h2>Engagement</h2>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="label">Commentaires</span>
              <span class="value">{{ statistics!.engagement.commentsCount }}</span>
            </div>
            <div class="stat-item">
              <span class="label">Phases Validées</span>
              <span class="value">{{ statistics!.engagement.phasesValidated }}</span>
            </div>
            <div class="stat-item">
              <span class="label">Réunions Planifiées</span>
              <span class="value">{{ statistics!.engagement.meetingsScheduled }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <ng-template #loading>
      <div class="loading">Chargement du tableau de bord...</div>
    </ng-template>
  </div>